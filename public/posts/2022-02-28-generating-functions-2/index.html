<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>More Generating Functions | Parth Kohli</title>
<meta name=keywords content="math,combinatorics,inclusion-exclusion"><meta name=description content="Today we take a look at the problem ABC241 H.
We are given $N \le 16$ distinct numbers $A_1, \cdots, A_N$ and a sequence describing the amount of supply of each number: a sequence $B_1, \cdots, B_N$ where $B_i$ refers to the supply of the number $A_i$. The score of a combination of $M$ chosen numbers is the product of the numbers. That is, suppose we pick $C_i$ occurences of the $A_i$ where $0 \le C_i \le B_i$ and $\sum C_i = M$, then $\text{score}(C) = \prod_{i = 1}^{N} A_i^{C_i}$. The objective is to find the sum of scores over all possible valid combinations."><meta name=author content="Parth Kohli"><link rel=canonical href=http://localhost:1313/posts/2022-02-28-generating-functions-2/><link crossorigin=anonymous href=/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css integrity="sha256-1vzSCk+4bvpN+sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/2022-02-28-generating-functions-2/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css integrity=sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+ crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js integrity=sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js integrity=sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk crossorigin=anonymous onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{strict:!1,trust:!0,delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\(",right:"\\)",display:!1},{left:"$",right:"$",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script><meta property="og:url" content="http://localhost:1313/posts/2022-02-28-generating-functions-2/"><meta property="og:site_name" content="Parth Kohli"><meta property="og:title" content="More Generating Functions"><meta property="og:description" content="Today we take a look at the problem ABC241 H.
We are given $N \le 16$ distinct numbers $A_1, \cdots, A_N$ and a sequence describing the amount of supply of each number: a sequence $B_1, \cdots, B_N$ where $B_i$ refers to the supply of the number $A_i$. The score of a combination of $M$ chosen numbers is the product of the numbers. That is, suppose we pick $C_i$ occurences of the $A_i$ where $0 \le C_i \le B_i$ and $\sum C_i = M$, then $\text{score}(C) = \prod_{i = 1}^{N} A_i^{C_i}$. The objective is to find the sum of scores over all possible valid combinations."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-02-28T00:00:00+00:00"><meta property="article:modified_time" content="2022-02-28T00:00:00+00:00"><meta property="article:tag" content="Math"><meta property="article:tag" content="Combinatorics"><meta property="article:tag" content="Inclusion-Exclusion"><meta property="og:image" content="http://localhost:1313/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/"><meta name=twitter:title content="More Generating Functions"><meta name=twitter:description content="Today we take a look at the problem ABC241 H.
We are given $N \le 16$ distinct numbers $A_1, \cdots, A_N$ and a sequence describing the amount of supply of each number: a sequence $B_1, \cdots, B_N$ where $B_i$ refers to the supply of the number $A_i$. The score of a combination of $M$ chosen numbers is the product of the numbers. That is, suppose we pick $C_i$ occurences of the $A_i$ where $0 \le C_i \le B_i$ and $\sum C_i = M$, then $\text{score}(C) = \prod_{i = 1}^{N} A_i^{C_i}$. The objective is to find the sum of scores over all possible valid combinations."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"More Generating Functions","item":"http://localhost:1313/posts/2022-02-28-generating-functions-2/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"More Generating Functions","name":"More Generating Functions","description":"Today we take a look at the problem ABC241 H.\nWe are given $N \\le 16$ distinct numbers $A_1, \\cdots, A_N$ and a sequence describing the amount of supply of each number: a sequence $B_1, \\cdots, B_N$ where $B_i$ refers to the supply of the number $A_i$. The score of a combination of $M$ chosen numbers is the product of the numbers. That is, suppose we pick $C_i$ occurences of the $A_i$ where $0 \\le C_i \\le B_i$ and $\\sum C_i = M$, then $\\text{score}(C) = \\prod_{i = 1}^{N} A_i^{C_i}$. The objective is to find the sum of scores over all possible valid combinations.\n","keywords":["math","combinatorics","inclusion-exclusion"],"articleBody":"Today we take a look at the problem ABC241 H.\nWe are given $N \\le 16$ distinct numbers $A_1, \\cdots, A_N$ and a sequence describing the amount of supply of each number: a sequence $B_1, \\cdots, B_N$ where $B_i$ refers to the supply of the number $A_i$. The score of a combination of $M$ chosen numbers is the product of the numbers. That is, suppose we pick $C_i$ occurences of the $A_i$ where $0 \\le C_i \\le B_i$ and $\\sum C_i = M$, then $\\text{score}(C) = \\prod_{i = 1}^{N} A_i^{C_i}$. The objective is to find the sum of scores over all possible valid combinations.\nThis statement might sound convoluted, but its intent is very clearly and naturally expressed in the language of generating functions. Observe that it translates to finding the coefficient of $x^M$ in the following:\n$$F(x) = \\prod_{i=1}^{N} \\sum_{j = 0}^{B_i} (A_j x)^j$$\nHere, the index $j$ represents the number of picked $A_i$’s. The sum of powers of $x$ should be $M$, and so our generating function would conveniently pick every valid combination of summing up to $M$ and collect the score for each such combination. Let’s now use the following identity:\n$$\\sum_{i=0}^{n} y^i = \\frac{1 - y^{n + 1}}{1 - y}$$\nAnd we get the following product:\n$$F(x) = \\prod_{i = 1}^{N} \\frac {1 - (A_i x)^{B_i+1}}{1 - A_i x}$$\nRemember that we are still only looking for the coefficient of $x^M$. The $B_i$’s are sort of annoying, so let’s turn our attention to a simpler problem: what if we have infinite supplies of each? In that case, we need the coefficient of $x^M$ in\n$$G(x) = \\prod_{i=1}^{N} \\frac{1}{1 - A_i x}$$\nWhich looks awfully familiar - oh wait, this can be decomposed using partial fractions! So let’s do it:\n$$G(x) = \\prod_{i = 1}^{N} \\frac{1}{1 - A_i x} = \\sum_{i = 1}^{N}\\frac{c_i}{1 - A_i x}$$\nA gentle reminder that it’s very easy to compute the decomposition when the denominator is conveniently split into a simple product of linear factors - it’s a matter of multiplying the product $\\prod_{i=1}^{N} (1 - A_i x)$ and for each $i$, plugging in $x = \\frac{1}{A_i}$, turning all except the term involving $c_i$ equal to $0$. This is naively done in $O(N^2)$ which is good enough given the unusually low constraint for $N$. To find the coefficient of $x^M$, we just expand $\\frac{1}{1 - A_i x}$ and see that it is doable in $O(N\\log_2{M})$ with binary exponentiation.\n$$G(x) = \\sum_{i=1}^{N} \\sum_{j=0}^{\\infty} c_i A_i^j x^j \\implies [x^M]G(x) = \\sum_{i=1}^{N} c_i A_i^{M} $$\nThere’s actually not much to be done at this point. Notice that\n$$F(x) = G(x) \\prod_{i=1}^{N} (1 - (A_i x)^{B_i + 1})$$\nThe product is interesting. For the $i$-th factor, we are making a choice: pick one of the two terms $1$ and $-(A_i x)^{B_i + 1}$. All $N$ choices are independent over every $i$ and so we have $2^N$ ways. We can look at every such way independently and add up the resulting coefficients of $x^M$ to obtain the answer. For example, one of these ways is choosing $1$ in every factor. In fact, this series of choices yields $G(x)$, so finding the coefficient of $x^M$ is exactly what we did above.\nThe other cases are not very different. Suppose the sum of the picked powers of $x$ in our $N$ choices is $s$ and the collected coefficient is $p$ (for example, $s = 0$ and $p = 1$ when we pick all $1$s). Then we need to find the coefficient of $x^{M - s}$ in $G(x)$ and multiply it by $p$ to give us one of the terms in the sum that involves $2^N$ terms. Of course, the coefficient of $x^{M - s}$ can be found in the same way as that of $x^M$. This gives us an $O(N^2 + 2^N \\cdot N \\cdot \\log_2 M)$ solution.\nIt is interesting to note that what we have done here is simply the inclusion-exclusion principle. We noticed that the answer is easily computable in the unrestricted case (call it $g(s)$ where $s$ is the sum of chosen numbers) and we want to compute it for the restricted case, call it $f(s)$. Then we look at the answer when some set of indices $S \\subseteq \\{ 1, \\cdots, n \\}$ violates its constraint, i.e., for every $i \\in S$, $C_i \\ge B_i + 1$ which is the same as an unrestricted $C_i’ = C_i - (B_i + 1) \\ge 0$ (except the score is scaled up by $A_i^{B_i + 1}$ to account for the offset) and so the expression looks like $$ f(M) = \\sum_{S} (-1)^{ \\mid S \\mid } \\left(\\prod_{i \\in S} A_i^{B_i + 1}\\right)g\\left(M - \\sum_{i\\in S} (B_i + 1)\\right)$$. This is identical to what we obtained using generating functions.\n","wordCount":"791","inLanguage":"en","image":"http://localhost:1313/","datePublished":"2022-02-28T00:00:00Z","dateModified":"2022-02-28T00:00:00Z","author":{"@type":"Person","name":"Parth Kohli"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/2022-02-28-generating-functions-2/"},"publisher":{"@type":"Organization","name":"Parth Kohli","logo":{"@type":"ImageObject","url":"http://localhost:1313/%3Clink%20/%20abs%20url%3E"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Home (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/categories/ title=Categories><span>Categories</span></a></li><li><a href=http://localhost:1313/tags/ title=Tags><span>Tags</span></a></li><li><a href=http://localhost:1313/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=http://localhost:1313/ title=Archive><span>Archive</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">More Generating Functions</h1><div class=post-meta><span title='2022-02-28 00:00:00 +0000 UTC'>February 28, 2022</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Parth Kohli</div></header><div class=post-content><p>Today we take a look at the problem <a href=https://atcoder.jp/contests/abc241/tasks/abc241_h>ABC241 H</a>.</p><p>We are given $N \le 16$ distinct numbers $A_1, \cdots, A_N$ and a sequence describing the amount of supply of each number: a sequence $B_1, \cdots, B_N$ where $B_i$ refers to the supply of the number $A_i$. The score of a combination of $M$ chosen numbers is the product of the numbers. That is, suppose we pick $C_i$ occurences of the $A_i$ where $0 \le C_i \le B_i$ and $\sum C_i = M$, then $\text{score}(C) = \prod_{i = 1}^{N} A_i^{C_i}$. The objective is to find the sum of scores over all possible valid combinations.</p><p>This statement might sound convoluted, but its intent is very clearly and naturally expressed in the language of generating functions. Observe that it translates to finding the coefficient of $x^M$ in the following:</p><p>$$F(x) = \prod_{i=1}^{N} \sum_{j = 0}^{B_i} (A_j x)^j$$</p><p>Here, the index $j$ represents the number of picked $A_i$&rsquo;s. The sum of powers of $x$ should be $M$, and so our generating function would conveniently pick every valid combination of summing up to $M$ and collect the score for each such combination. Let&rsquo;s now use the following identity:</p><p>$$\sum_{i=0}^{n} y^i = \frac{1 - y^{n + 1}}{1 - y}$$</p><p>And we get the following product:</p><p>$$F(x) = \prod_{i = 1}^{N} \frac {1 - (A_i x)^{B_i+1}}{1 - A_i x}$$</p><p>Remember that we are still only looking for the coefficient of $x^M$. The $B_i$&rsquo;s are sort of annoying, so let&rsquo;s turn our attention to a simpler problem: what if we have infinite supplies of each? In that case, we need the coefficient of $x^M$ in</p><p>$$G(x) = \prod_{i=1}^{N} \frac{1}{1 - A_i x}$$</p><p>Which looks awfully familiar - oh wait, this can be decomposed using partial fractions! So let&rsquo;s do it:</p><p>$$G(x) = \prod_{i = 1}^{N} \frac{1}{1 - A_i x} = \sum_{i = 1}^{N}\frac{c_i}{1 - A_i x}$$</p><p>A gentle reminder that it&rsquo;s very easy to compute the decomposition when the denominator is conveniently split into a simple product of linear factors - it&rsquo;s a matter of multiplying the product $\prod_{i=1}^{N} (1 - A_i x)$ and for each $i$, plugging in $x = \frac{1}{A_i}$, turning all except the term involving $c_i$ equal to $0$. This is naively done in $O(N^2)$ which is good enough given the unusually low constraint for $N$. To find the coefficient of $x^M$, we just expand $\frac{1}{1 - A_i x}$ and see that it is doable in $O(N\log_2{M})$ with binary exponentiation.</p><p>$$G(x) = \sum_{i=1}^{N} \sum_{j=0}^{\infty} c_i A_i^j x^j \implies [x^M]G(x) = \sum_{i=1}^{N} c_i A_i^{M} $$</p><p>There&rsquo;s actually not much to be done at this point. Notice that</p><p>$$F(x) = G(x) \prod_{i=1}^{N} (1 - (A_i x)^{B_i + 1})$$</p><p>The product is interesting. For the $i$-th factor, we are making a choice: pick one of the two terms $1$ and $-(A_i x)^{B_i + 1}$. All $N$ choices are independent over every $i$ and so we have $2^N$ ways. We can look at every such way independently and add up the resulting coefficients of $x^M$ to obtain the answer. For example, one of these ways is choosing $1$ in every factor. In fact, this series of choices yields $G(x)$, so finding the coefficient of $x^M$ is exactly what we did above.</p><p>The other cases are not very different. Suppose the sum of the picked powers of $x$ in our $N$ choices is $s$ and the collected coefficient is $p$ (for example, $s = 0$ and $p = 1$ when we pick all $1$s). Then we need to find the coefficient of $x^{M - s}$ in $G(x)$ and multiply it by $p$ to give us one of the terms in the sum that involves $2^N$ terms. Of course, the coefficient of $x^{M - s}$ can be found in the same way as that of $x^M$. This gives us an $O(N^2 + 2^N \cdot N \cdot \log_2 M)$ solution.</p><p>It is interesting to note that what we have done here is simply the <a href=https://en.wikipedia.org/wiki/Inclusion%E2%80%93exclusion_principle>inclusion-exclusion principle</a>. We noticed that the answer is easily computable in the unrestricted case (call it $g(s)$ where $s$ is the sum of chosen numbers) and we want to compute it for the restricted case, call it $f(s)$. Then we look at the answer when some set of indices $S \subseteq \{ 1, \cdots, n \}$ violates its constraint, i.e., for every $i \in S$, $C_i \ge B_i + 1$ which is the same as an unrestricted $C_i&rsquo; = C_i - (B_i + 1) \ge 0$ (except the score is scaled up by $A_i^{B_i + 1}$ to account for the offset) and so the expression looks like $$ f(M) = \sum_{S} (-1)^{ \mid S \mid } \left(\prod_{i \in S} A_i^{B_i + 1}\right)g\left(M - \sum_{i\in S} (B_i + 1)\right)$$. This is identical to what we obtained using generating functions.</p></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/math/>Math</a></li><li><a href=http://localhost:1313/tags/combinatorics/>Combinatorics</a></li><li><a href=http://localhost:1313/tags/inclusion-exclusion/>Inclusion-Exclusion</a></li></ul><nav class=paginav><a class=next href=http://localhost:1313/posts/2022-02-05-random-or/><span class=title>Next »</span><br><span>Random OR</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/>Parth Kohli</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>